!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
SUBROUTINE EvaluateLocalVectorField( x0, Sol1, nodes, pp0, idof, u0, id )
 IMPLICIT NONE
 INTEGER :: nodes, idof
 INTEGER :: id, ndim
 INTEGER :: i, j, k, nci
 INTEGER :: Gu, pp0( 3 )
 PARAMETER( Ndim = 3 ) 
 
 DOUBLE PRECISION :: x0( Ndim )
 DOUBLE PRECISION :: sol1(*)
 DOUBLE PRECISION :: u0( idof )
 
 DOUBLE PRECISION :: Velocity( nodes ), dVelocity( Ndim, nodes ), WSSBasis( nodes )
 DOUBLE PRECISION :: Pressure( nodes )
 
 Gu = int( sqrt( nodes / 3.d0 ) )
 CALL Pipe_FieldBasis3D_adap( x0, pp0, nodes, Velocity, dVelocity, Pressure ) 
 WSSBasis = Velocity
 
 u0 = 0.0d0
 DO i = 1, nodes
       DO j = 1, Ndim
              u0( j ) = u0( j ) + sol1( (i-1)*idof + j ) * Velocity( i )
              IF( idof .EQ. 7 ) u0( j + 4 ) = u0( j + 4 ) + sol1( (i-1)*idof + 4 + j ) * WSSBasis( i )
       ENDDO
       u0( 4 ) = u0( 4 ) + sol1( (i-1)*idof + 4 ) * Pressure( i )
 ENDDO
END SUBROUTINE

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
SUBROUTINE EvaluateMeanVectorField( x0, Sol1, nodes, pp0, idof, u0, id )
 IMPLICIT NONE
 INTEGER :: nodes, idof
 INTEGER :: id, ndim
 INTEGER :: i, j, k, nci
 INTEGER :: Gu, pp0( 3 )
 PARAMETER( Ndim = 3 ) 
 
 DOUBLE PRECISION :: x0( Ndim )
 DOUBLE PRECISION :: sol1(*)
 DOUBLE PRECISION :: u0( idof )
 
 DOUBLE PRECISION :: Velocity( nodes ), dVelocity( Ndim, nodes ), WSSBasis( nodes )
 DOUBLE PRECISION :: Pressure( nodes )
 
 Gu = int( sqrt( nodes / 3.d0 ) )
 CALL Pipe_FieldBasis3D_adap( x0, pp0, nodes, Velocity, dVelocity, Pressure ) 
 WSSBasis = Velocity
 
  u0 = 0.0d0
  DO i = 1, nodes
    u0( 1 ) = u0( 1 ) + sol1( ( i-1)*idof + 1 )*velocity( i )
    u0( 2 ) = u0( 2 ) + sol1( ( i-1)*idof + 2 )*velocity( i )
    u0( 3 ) = u0( 3 ) + sol1( ( i-1)*idof + 3 )*velocity( i )
    u0( 4 ) = u0( 4 ) + sol1( ( i-1)*idof + 4 )*pressure( i )
    u0( 5 ) = u0( 5 ) + sol1( ( i-1)*idof + 5 )*velocity( i )
  ENDDO
END SUBROUTINE

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
SUBROUTINE EvaluateDisplacementField( x0, Sol1, nodes, pp0, idof, d0, id, SerP )
  IMPLICIT NONE
  INTEGER :: nodes, idof
  INTEGER :: id, ndim
  INTEGER :: i, j, k, nci
  INTEGER :: Gu, pp0( 3 )
  PARAMETER( Ndim = 3 ) 
 
  DOUBLE PRECISION :: x0( Ndim )
  DOUBLE PRECISION :: sol1(*)
  DOUBLE PRECISION :: d0( ndim )
 
  DOUBLE PRECISION :: Velocity( nodes ), dVelocity( Ndim, nodes ), WSSBasis( nodes )
  DOUBLE PRECISION :: Pressure( nodes ), SerP( 54 ), hrad
  DOUBLE PRECISION :: p3, p9, p21, p27, p12, p18, pwall0
  DOUBLE PRECISION :: k1, k2, k3, alpha, n0( ndim ), bNormal( 27,ndim ) 
  
	DOUBLE PRECISION :: parElast, parRadius, parhh
  DOUBLE PRECISION :: para, parb, parc, pard, parE
    
	!! Elemental width
	hrad  = 4*norm2(.5*(SerP(31:33) + SerP(34:36) - SerP(19:21) - SerP(28:30)))
	
  d0 = 0.d0
  IF( id .EQ. 37 ) RETURN
  
  pwall0 = 106001.482750
  p3 = sol1( ( 3 - 1 )*idof + 4 ) - pwall0; p9 = sol1( ( 9 - 1 )*idof + 4 ) - pwall0
  p21= sol1( (21 - 1 )*idof + 4 ) - pwall0; p27= sol1( (27 - 1 )*idof + 4 ) - pwall0
  
  bNormal = 0.d0  
  IF( .TRUE. ) THEN		!! Radius-dependent elasticity
    k1 = 2.0e+7; k2 = -22.53; k3 = 8.65e+5
    alpha = hrad/( k1*exp(k2*hrad) + k3 )
  
      n0 = SerP( 4:6 ) - SerP( 1:3 );         hrad = 4*norm2(n0); 
      alpha = hrad/( k1*exp(k2*hrad) + k3 ); 
      !IF( abs(p3)*alpha .GT. 0.6*norm2(n0) ) alpha = 0.6*norm2(n0)/abs( p3 ) 
      bNormal( 3,:) = alpha*n0/norm2(n0)
    
      n0 = serP( 7:9 ) - SerP(10:12);         hrad = 4*norm2(n0); 
      alpha = hrad/( k1*exp(k2*hrad) + k3 ); 
      !IF( abs(p9)*alpha .GT. 0.6*norm2(n0) ) alpha = 0.6*norm2(n0)/abs( p9 ) 
      bNormal( 9,:) = alpha*n0/norm2(n0)

      n0 = serP(40:42) - SerP(37:39);           hrad = 4*norm2(n0); 
      alpha = hrad/( k1*exp(k2*hrad) + k3 );  
      !IF( abs(p21)*alpha .GT. 0.6*norm2(n0) ) alpha = 0.6*norm2(n0)/abs( p21 ) 
      bNormal(21,:) = alpha*n0/norm2(n0)

      n0 = serP(43:45) - SerP(46:48);           hrad = 4*norm2(n0); 
      alpha = hrad/( k1*exp(k2*hrad) + k3 ); 
      !IF( abs(p27)*alpha .GT. 0.6*norm2(n0) ) alpha = 0.6*norm2(n0)/abs( p27 ) 
      bNormal(27,:) = alpha*n0/norm2(n0)


    !! Blanco ( 2013 ) - Blood flow distribution in an anatomically detailed arterial network model
    para = 0.2802
    parb = -5.053
    parc = 0.1324
    pard = -0.1114
    parE = 4.e+6
    !parE = 1.e+6
    !parE = 0.25e+6

      n0 = SerP( 4:6 ) - SerP( 1:3 );         hrad = 4*norm2(n0); 
      alpha = ( parE/hrad ) * ( para * exp(parb*hrad) + parc * exp( pard*hrad ))
      bNormal( 3,:) = (1./alpha)*n0/norm2(n0)
    
      n0 = serP( 7:9 ) - SerP(10:12);         hrad = 4*norm2(n0); 
      alpha = ( parE/hrad ) * ( para * exp(parb*hrad) + parc * exp( pard*hrad ))
      bNormal( 9,:) = (1./alpha)*n0/norm2(n0)

      n0 = serP(40:42) - SerP(37:39);           hrad = 4*norm2(n0); 
      alpha = ( parE/hrad ) * ( para * exp(parb*hrad) + parc * exp( pard*hrad ))
      bNormal(21,:) = (1./alpha)*n0/norm2(n0)

      n0 = serP(43:45) - SerP(46:48);           hrad = 4*norm2(n0); 
      alpha = ( parE/hrad ) * ( para * exp(parb*hrad) + parc * exp( pard*hrad ))
      bNormal(27,:) = (1./alpha)*n0/norm2(n0)

    k1 = 2.0e+7; k2 = -22.53; k3 = 8.65e+5
      n0 = SerP( 4:6 ) - SerP( 1:3 );         hrad = 4*norm2(n0); 
      alpha = hrad/( k1*exp(k2*hrad) + k3 ); 
      !bNormal( 3,:) = alpha*n0/norm2(n0)
    
      n0 = serP( 7:9 ) - SerP(10:12);         hrad = 4*norm2(n0); 
      alpha = hrad/( k1*exp(k2*hrad) + k3 ); 
      !bNormal( 9,:) = alpha*n0/norm2(n0)

      n0 = serP(40:42) - SerP(37:39);           hrad = 4*norm2(n0); 
      alpha = hrad/( k1*exp(k2*hrad) + k3 ); 
      !bNormal(21,:) = alpha*n0/norm2(n0)

      n0 = serP(43:45) - SerP(46:48);           hrad = 4*norm2(n0); 
      alpha = hrad/( k1*exp(k2*hrad) + k3 ); 
      !bNormal(27,:) = alpha*n0/norm2(n0)

	ELSE
		!alpha = (2.5/3.)*1.e-6
		
		!parElast = 3.e+6;     parRadius= 0.5; parhh = 0.1
    !parElast = 0.3996e+6; parRadius= 0.3; parhh = 0.1
    !parElast = 0.1998e+6; parRadius= 0.3; parhh = 0.1
    parElast = 2.664e+6; parRadius = 0.3; parhh = 0.03
    parElast = 1.332e+6; parRadius = 0.3; parhh = 0.03
    parElast = 0.666e+6; parRadius = 0.3; parhh = 0.03

    alpha = ( parRadius**2 )/( parhh*parElast )
    
			n0 = SerP( 4:6 ) - SerP( 1:3 )
			n0 = serP(4:6) - [SerP(4),0.d0, 0.d0]
		  bNormal( 3,:) = alpha*n0/norm2(n0)
		
			n0 = serP( 7:9 ) - SerP(10:12)
			n0 = serP( 7:9 ) - [SerP(7),0.d0, 0.d0]
		  bNormal( 9,:) = alpha*n0/norm2(n0)

			n0 = serP(40:42) - SerP(37:39)
			n0 = serP(40:42) - [SerP(40),0.d0, 0.d0]
		  bNormal(21,:) = alpha*n0/norm2(n0)

			n0 = serP(43:45) - SerP(46:48)
			n0 = serP(43:45) - [SerP(43),0.d0, 0.d0]
		  bNormal(27,:) = alpha*n0/norm2(n0)
	ENDIF    

  Gu = int( sqrt( nodes / 3.d0 ) )
  CALL Pipe_FieldBasis3D_adap( x0, pp0, nodes, Velocity, dVelocity, Pressure ) 
 
  d0 = 0.0d0
  DO i = 1, nodes
  DO j = 1, Ndim
    d0( j ) = d0( j ) + ( sol1( (i-1)*idof + 4 ) - 106001.482750 ) * Pressure( i ) * bNormal( i,j )
  ENDDO
  ENDDO
END SUBROUTINE 

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!  
!!! Field approximation functions - 14/11/2019
!!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
SUBROUTINE Pipe_FieldBasis2D( id, coor, Gu, Fi, dFi ) 
  IMPLICIT NONE
  INTEGER, PARAMETER :: Ndim = 3
  INTEGER, INTENT( IN ) :: id, gu
  INTEGER :: i, j, k, n, gg

  DOUBLE PRECISION :: coor( Ndim ), Fi( Gu**2 ), dFi( Ndim, Gu**2 )
  DOUBLE PRECISION :: Px( Gu ), dPx( Gu )
  DOUBLE PRECISION :: Py( Gu ), dPy( Gu )

  gg = ( Gu + id )/( id + 1 )
  Px = 0.0d0; Py = 0.0d0; dPx= 0.0d0; dPy = 0.0d0
  CALL HighLagrange( coor(1), Gg, Px( 1:Gu:id+1 ), dPx( 1:Gu:id+1 ) )
  CALL HighLagrange( coor(2), Gg, Py( 1:Gu:id+1 ), dPy( 1:Gu:id+1 ) )

  n = 0; Fi = 0.0d0; dFi = 0.0d0
  DO j = 1, Gu
  DO i = 1, Gu
    n = n + 1
    Fi( n ) = Px( i ) * Py( j )
    dFi( 1, n ) = dPx( i ) * Py( j )
    dFi( 2, n ) = Px( i ) * dPy( j )
  ENDDO
  ENDDO
END SUBROUTINE

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
SUBROUTINE Pipe_FieldBasis3D( x0, Gu, uVel, duVel, uPre )
  IMPLICIT NONE
  INTEGER, PARAMETER :: Ndim = 3
  INTEGER, INTENT( IN ) :: Gu

  INTEGER :: nci, ncj, nck, gp
  DOUBLE PRECISION :: x, y, z
  DOUBLE PRECISION :: x0( ndim )
  DOUBLE PRECISION :: uPre( 3*gu**2 ), uvel( 3*gu**2 ), duvel( ndim,3*gu**2 )
  DOUBLE PRECISION :: Fi( gu**2 ), dFi( ndim,gu**2 )

  Gp = nint( 0.5 * ( Gu + 1 ) )
  x = x0( 1 ); y = x0( 2 ); z = x0( 3 )
  uvel = 0.d0; duvel = 0.d0; upre = 0.d0
  
  !! Velocity
  CALL Pipe_FieldBasis2D( 0, x0, Gu, Fi, dFi )
  nci = 0
    uVel( nci + 1:nci + Gu**2 )    = 0.5 * z * ( z - 1 ) *  Fi( 1:Gu**2 )
    duVel( 1,nci + 1:nci + Gu**2 ) = 0.5 * z * ( z - 1 ) * dFi( 1,1:Gu**2 )
    duVel( 2,nci + 1:nci + Gu**2 ) = 0.5 * z * ( z - 1 ) * dFi( 2,1:Gu**2 )
    duVel( 3,nci + 1:nci + Gu**2 ) = 0.5 * ( 2*z - 1 ) * Fi( 1:Gu**2 )
  nci = nci + Gu**2
    uVel( nci + 1:nci + Gu**2 )    = ( 1. - z**2 ) *  Fi( 1:Gu**2 )
    duVel( 1,nci + 1:nci + Gu**2 ) = ( 1. - z**2 ) * dFi( 1,1:Gu**2 )
    duVel( 2,nci + 1:nci + Gu**2 ) = ( 1. - z**2 ) * dFi( 2,1:Gu**2 )
    duVel( 3,nci + 1:nci + Gu**2 ) = ( -2*z )  * Fi( 1:Gu**2 )
  nci = nci + Gu**2
    uVel( nci + 1:nci + Gu**2 )    = 0.5 * z * ( z + 1 ) *  Fi( 1:Gu**2 )
    duVel( 1,nci + 1:nci + Gu**2 ) = 0.5 * z * ( z + 1 ) * dFi( 1,1:Gu**2 )
    duVel( 2,nci + 1:nci + Gu**2 ) = 0.5 * z * ( z + 1 ) * dFi( 2,1:Gu**2 )
    duVel( 3,nci + 1:nci + Gu**2 ) = 0.5 * ( 2*z + 1 ) * Fi( 1:Gu**2 )

  !! Pressure
  CALL Pipe_FieldBasis2D( 1, x0, Gu, Fi, dFi )   
  nci = 0
    uPre( nci + 1:nci + Gu**2 ) = 0.5 * ( 1. - z ) *  Fi( 1:Gu**2 )
  nci = nci + Gu**2
  nci = nci + Gu**2
    uPre( nci + 1:nci + Gu**2 ) = 0.5 * ( 1. + z ) *  Fi( 1:Gu**2 )
END SUBROUTINE

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
SUBROUTINE Pipe_FieldBasis3D_adap( x0, pp, nodes, uVel, duVel, uPre )
  IMPLICIT NONE
  INTEGER, PARAMETER :: Ndim = 3

  INTEGER :: nci, ncj, nck, gp, pp( 3 ), nodes, gu
  DOUBLE PRECISION :: x, y, z
  DOUBLE PRECISION :: x0( ndim )
  DOUBLE PRECISION :: uPre( nodes ), uvel( nodes ), duvel( ndim,nodes )
  DOUBLE PRECISION :: Fi( 144 ), dFi( ndim,144 )

  x = x0( 1 ); y = x0( 2 ); z = x0( 3 )
  uvel = 0.d0; duvel = 0.d0; upre = 0.d0
  
  !! Velocity
  nci = 0;      Gu = pp( 1 ) + 1; 
  CALL Pipe_FieldBasis2D( 0, x0, Gu, Fi(1:Gu**2), dFi(1:ndim,1:Gu**2) )
    uVel( nci + 1:nci + Gu**2 )    = 0.5 * z * ( z - 1 ) *  Fi( 1:Gu**2 )
    duVel( 1,nci + 1:nci + Gu**2 ) = 0.5 * z * ( z - 1 ) * dFi( 1,1:Gu**2 )
    duVel( 2,nci + 1:nci + Gu**2 ) = 0.5 * z * ( z - 1 ) * dFi( 2,1:Gu**2 )
    duVel( 3,nci + 1:nci + Gu**2 ) = 0.5 * ( 2*z - 1 ) * Fi( 1:Gu**2 )
  
  nci = nci + Gu**2; Gu = pp( 2 ) + 1; 
  CALL Pipe_FieldBasis2D( 0, x0, Gu, Fi(1:Gu**2), dFi(1:ndim,1:Gu**2) )
    uVel( nci + 1:nci + Gu**2 )    = ( 1. - z**2 ) *  Fi( 1:Gu**2 )
    duVel( 1,nci + 1:nci + Gu**2 ) = ( 1. - z**2 ) * dFi( 1,1:Gu**2 )
    duVel( 2,nci + 1:nci + Gu**2 ) = ( 1. - z**2 ) * dFi( 2,1:Gu**2 )
    duVel( 3,nci + 1:nci + Gu**2 ) = ( -2*z )  * Fi( 1:Gu**2 )
  
  nci = nci + Gu**2; Gu = pp( 3 ) + 1; 
  CALL Pipe_FieldBasis2D( 0, x0, Gu, Fi(1:Gu**2), dFi(1:ndim,1:Gu**2) )
    uVel( nci + 1:nci + Gu**2 )    = 0.5 * z * ( z + 1 ) *  Fi( 1:Gu**2 )
    duVel( 1,nci + 1:nci + Gu**2 ) = 0.5 * z * ( z + 1 ) * dFi( 1,1:Gu**2 )
    duVel( 2,nci + 1:nci + Gu**2 ) = 0.5 * z * ( z + 1 ) * dFi( 2,1:Gu**2 )
    duVel( 3,nci + 1:nci + Gu**2 ) = 0.5 * ( 2*z + 1 ) * Fi( 1:Gu**2 )

  !! Pressure
  nci = 0;      Gu = pp( 1 ) + 1; 
  CALL Pipe_FieldBasis2D( 1, x0, Gu, Fi(1:Gu**2), dFi(1:ndim,1:Gu**2) )
    uPre( nci + 1:nci + Gu**2 ) = 0.5 * ( 1. - z ) *  Fi( 1:Gu**2 )
  nci = nci + Gu**2; Gu = pp( 2 ) + 1; 
  nci = nci + Gu**2; Gu = pp( 3 ) + 1; 
  CALL Pipe_FieldBasis2D( 1, x0, Gu, Fi(1:Gu**2), dFi(1:ndim,1:Gu**2) )
    uPre( nci + 1:nci + Gu**2 ) = 0.5 * ( 1. + z ) *  Fi( 1:Gu**2 )
END SUBROUTINE

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
SUBROUTINE HighLagrange( t, Gu, P, dP )
  IMPLICIT NONE
  INTEGER :: Gu
  DOUBLE PRECISION :: t, P( Gu ), dP( Gu )

  SELECT CASE( Gu )
  Case( 2 )
  P( 1 ) = -0.500000000000000*t + 0.500000000000000
  dP( 1 ) = -0.500000000000000
  P( 2 ) = 0.500000000000000*t + 0.500000000000000
  dP( 2 ) = 0.500000000000000

  Case( 3 )
  P( 1 ) = (-0.5)*t**1 + (0.5)*t**2 
  dP( 1 ) = (-0.5)*t**0 + (1)*t**1 
  P( 2 ) = (1.0)*t**0 + (-1.0)*t**2 
  dP( 2 ) = (-2.0)*t**1 
  P( 3 ) = (0.5)*t**1 + (0.5)*t**2 
  dP( 3 ) = (0.5)*t**0 + (1)*t**1 

  Case( 4 )
  P( 1 ) = (-0.166666666667)*t**0 + (0.166666666667)*t**1 + (0.666666666667)*t**2 + &
   (-0.666666666667)*t**3 
  dP( 1 ) = (0.166666666667)*t**0 + (1.33333333333)*t**1 + (-2.0)*t**2 
  P( 2 ) = (0.666666666667)*t**0 + (-1.33333333333)*t**1 + (-0.666666666667)*t**2 + &
   (1.33333333333)*t**3 
  dP( 2 ) = (-1.33333333333)*t**0 + (-1.33333333333)*t**1 + (4.0)*t**2 
  P( 3 ) = (0.666666666667)*t**0 + (1.33333333333)*t**1 + (-0.666666666667)*t**2 + &
   (-1.33333333333)*t**3 
  dP( 3 ) = (1.33333333333)*t**0 + (-1.33333333333)*t**1 + (-4.0)*t**2 
  P( 4 ) = (-0.166666666667)*t**0 + (-0.166666666667)*t**1 + (0.666666666667)*t**2 + &
   (0.666666666667)*t**3 
  dP( 4 ) = (-0.166666666667)*t**0 + (1.33333333333)*t**1 + (2.0)*t**2 

  Case( 5 )
  P( 1 ) = (0.5)*t**1 + (-0.5)*t**2 + (-1.0)*t**3 + &
   (1.0)*t**4 
  dP( 1 ) = (0.5)*t**0 + (-1.0)*t**1 + (-3.0)*t**2 + &
   (4.0)*t**3 
  P( 2 ) = (-1.41421356237)*t**1 + (2.0)*t**2 + (1.41421356237)*t**3 + &
   (-2.0)*t**4 
  dP( 2 ) = (-1.41421356237)*t**0 + (4.0)*t**1 + (4.24264068712)*t**2 + &
   (-8.0)*t**3 
  P( 3 ) = (1.0)*t**0 + (-3.0)*t**2 + (2.0)*t**4 
  dP( 3 ) = (-6.0)*t**1 + (8.0)*t**3 
  P( 4 ) = (1.41421356237)*t**1 + (2.0)*t**2 + (-1.41421356237)*t**3 + &
   (-2.0)*t**4 
  dP( 4 ) = (1.41421356237)*t**0 + (4.0)*t**1 + (-4.24264068712)*t**2 + &
   (-8.0)*t**3 
  P( 5 ) = (-0.5)*t**1 + (-0.5)*t**2 + (1.0)*t**3 + &
   (1.0)*t**4 
  dP( 5 ) = (-0.5)*t**0 + (-1.0)*t**1 + (3.0)*t**2 + &
   (4.0)*t**3 

  Case( 6 )
  P( 1 ) = (0.1)*t**0 + (-0.1)*t**1 + (-1.2)*t**2 + &
   (1.2)*t**3 + (1.6)*t**4 + (-1.6)*t**5 
  dP( 1 ) = (-0.1)*t**0 + (-2.4)*t**1 + (3.6)*t**2 + &
   (6.4)*t**3 + (-8.0)*t**4 
  P( 2 ) = (-0.2472135955)*t**0 + (0.305572809)*t**1 + (2.8360679775)*t**2 + &
   (-3.505572809)*t**3 + (-2.588854382)*t**4 + (3.2)*t**5 
  dP( 2 ) = (0.305572809)*t**0 + (5.672135955)*t**1 + (-10.516718427)*t**2 + &
   (-10.355417528)*t**3 + (16.0)*t**4 
  P( 3 ) = (0.6472135955)*t**0 + (-2.094427191)*t**1 + (-1.6360679775)*t**2 + &
   (5.294427191)*t**3 + (0.988854382)*t**4 + (-3.2)*t**5 
  dP( 3 ) = (-2.094427191)*t**0 + (-3.272135955)*t**1 + (15.883281573)*t**2 + &
   (3.955417528)*t**3 + (-16.0)*t**4 
  P( 4 ) = (0.6472135955)*t**0 + (2.094427191)*t**1 + (-1.6360679775)*t**2 + &
   (-5.294427191)*t**3 + (0.988854382)*t**4 + (3.2)*t**5 
  dP( 4 ) = (2.094427191)*t**0 + (-3.272135955)*t**1 + (-15.883281573)*t**2 + &
   (3.955417528)*t**3 + (16.0)*t**4 
  P( 5 ) = (-0.2472135955)*t**0 + (-0.305572809)*t**1 + (2.8360679775)*t**2 + &
   (3.505572809)*t**3 + (-2.588854382)*t**4 + (-3.2)*t**5 
  dP( 5 ) = (-0.305572809)*t**0 + (5.672135955)*t**1 + (10.516718427)*t**2 + &
   (-10.355417528)*t**3 + (-16.0)*t**4 
  P( 6 ) = (0.1)*t**0 + (0.1)*t**1 + (-1.2)*t**2 + &
   (-1.2)*t**3 + (1.6)*t**4 + (1.6)*t**5 
  dP( 6 ) = (0.1)*t**0 + (-2.4)*t**1 + (-3.6)*t**2 + &
   (6.4)*t**3 + (8.0)*t**4 

  Case( 7 )
  P( 1 ) = (-0.5)*t**1 + (0.5)*t**2 + (2.66666666667)*t**3 + &
   (-2.66666666667)*t**4 + (-2.66666666667)*t**5 + (2.66666666667)*t**6 
  dP( 1 ) = (-0.5)*t**0 + (1.0)*t**1 + (8.0)*t**2 + &
   (-10.6666666667)*t**3 + (-13.3333333333)*t**4 + (16.0)*t**5 
  P( 2 ) = (1.15470053838)*t**1 + (-1.33333333333)*t**2 + (-5.7735026919)*t**3 + &
   (6.66666666667)*t**4 + (4.61880215352)*t**5 + (-5.33333333333)*t**6 
  dP( 2 ) = (1.15470053838)*t**0 + (-2.66666666667)*t**1 + (-17.3205080757)*t**2 + &
   (26.6666666667)*t**3 + (23.0940107676)*t**4 + (-32.0)*t**5 
  P( 3 ) = (-2.0)*t**1 + (4.0)*t**2 + (4.66666666667)*t**3 + &
   (-9.33333333333)*t**4 + (-2.66666666667)*t**5 + (5.33333333333)*t**6 
  dP( 3 ) = (-2.0)*t**0 + (8.0)*t**1 + (14.0)*t**2 + &
   (-37.3333333333)*t**3 + (-13.3333333333)*t**4 + (32.0)*t**5 
  P( 4 ) = (1.0)*t**0 + (-6.66133814775e-16)*t**1 + (-6.33333333333)*t**2 + &
   (-8.881784197e-16)*t**3 + (10.6666666667)*t**4 + (-5.33333333333)*t**6 
  dP( 4 ) = (-2.22044604925e-16)*t**0 + (-12.6666666667)*t**1 + (-4.4408920985e-15)*t**2 + &
   (42.6666666667)*t**3 + (-1.7763568394e-15)*t**4 + (-32.0)*t**5 
  P( 5 ) = (2.0)*t**1 + (4.0)*t**2 + (-4.66666666667)*t**3 + &
   (-9.33333333333)*t**4 + (2.66666666667)*t**5 + (5.33333333333)*t**6 
  dP( 5 ) = (2.0)*t**0 + (8.0)*t**1 + (-14.0)*t**2 + &
   (-37.3333333333)*t**3 + (13.3333333333)*t**4 + (32.0)*t**5 
  P( 6 ) = (-1.15470053838)*t**1 + (-1.33333333333)*t**2 + (5.7735026919)*t**3 + &
   (6.66666666667)*t**4 + (-4.61880215352)*t**5 + (-5.33333333333)*t**6 
  dP( 6 ) = (-1.15470053838)*t**0 + (-2.66666666667)*t**1 + (17.3205080757)*t**2 + &
   (26.6666666667)*t**3 + (-23.0940107676)*t**4 + (-32.0)*t**5 
  P( 7 ) = (0.5)*t**1 + (0.5)*t**2 + (-2.66666666667)*t**3 + &
   (-2.66666666667)*t**4 + (2.66666666667)*t**5 + (2.66666666667)*t**6 
  dP( 7 ) = (0.5)*t**0 + (1.0)*t**1 + (-8.0)*t**2 + &
   (-10.6666666667)*t**3 + (13.3333333333)*t**4 + (16.0)*t**5 

  Case( 8 )
  P( 1 ) = (-0.0714285714286)*t**0 + (0.0714285714286)*t**1 + (1.71428571429)*t**2 + &
   (-1.71428571429)*t**3 + (-5.71428571429)*t**4 + (5.71428571429)*t**5 + &
   (4.57142857143)*t**6 + (-4.57142857143)*t**7 
  dP( 1 ) = (0.0714285714286)*t**0 + (3.42857142857)*t**1 + (-5.14285714286)*t**2 + &
   (-22.8571428571)*t**3 + (28.5714285714)*t**4 + (27.4285714286)*t**5 + &
   (-32.0)*t**6 
  P( 2 ) = (0.158559466311)*t**0 + (-0.175987730497)*t**1 + (-3.76865501339)*t**2 + &
   (4.18289149343)*t**3 + (11.8475251965)*t**4 + (-13.1497609058)*t**5 + &
   (-8.23742964939)*t**6 + (9.14285714286)*t**7 
  dP( 2 ) = (-0.175987730497)*t**0 + (-7.53731002679)*t**1 + (12.5486744803)*t**2 + &
   (47.3901007859)*t**3 + (-65.7488045289)*t**4 + (-49.4245778964)*t**5 + &
   (64.0)*t**6 
  P( 3 ) = (-0.229125067373)*t**0 + (0.36748807549)*t**1 + (5.13872157393)*t**2 + &
   (-8.24186948786)*t**3 + (-10.610074695)*t**4 + (17.0172385552)*t**5 + &
   (5.70047818842)*t**6 + (-9.14285714286)*t**7 
  dP( 3 ) = (0.36748807549)*t**0 + (10.2774431479)*t**1 + (-24.7256084636)*t**2 + &
   (-42.4402987799)*t**3 + (85.0861927761)*t**4 + (34.2028691305)*t**5 + &
   (-64.0)*t**6 
  P( 4 ) = (0.641994172491)*t**0 + (-2.88509562258)*t**1 + (-3.08435227483)*t**2 + &
   (13.8609533044)*t**3 + (4.47683521279)*t**4 + (-20.1187148247)*t**5 + &
   (-2.03447711046)*t**6 + (9.14285714286)*t**7 
  dP( 4 ) = (-2.88509562258)*t**0 + (-6.16870454965)*t**1 + (41.5828599133)*t**2 + &
   (17.9073408512)*t**3 + (-100.593574123)*t**4 + (-12.2068626627)*t**5 + &
   (64.0)*t**6 
  P( 5 ) = (0.641994172491)*t**0 + (2.88509562258)*t**1 + (-3.08435227483)*t**2 + &
   (-13.8609533044)*t**3 + (4.47683521279)*t**4 + (20.1187148247)*t**5 + &
   (-2.03447711046)*t**6 + (-9.14285714286)*t**7 
  dP( 5 ) = (2.88509562258)*t**0 + (-6.16870454965)*t**1 + (-41.5828599133)*t**2 + &
   (17.9073408512)*t**3 + (100.593574123)*t**4 + (-12.2068626627)*t**5 + &
   (-64.0)*t**6 
  P( 6 ) = (-0.229125067373)*t**0 + (-0.36748807549)*t**1 + (5.13872157393)*t**2 + &
   (8.24186948786)*t**3 + (-10.610074695)*t**4 + (-17.0172385552)*t**5 + &
   (5.70047818842)*t**6 + (9.14285714286)*t**7 
  dP( 6 ) = (-0.36748807549)*t**0 + (10.2774431479)*t**1 + (24.7256084636)*t**2 + &
   (-42.4402987799)*t**3 + (-85.0861927761)*t**4 + (34.2028691305)*t**5 + &
   (64.0)*t**6 
  P( 7 ) = (0.158559466311)*t**0 + (0.175987730497)*t**1 + (-3.76865501339)*t**2 + &
   (-4.18289149343)*t**3 + (11.8475251965)*t**4 + (13.1497609058)*t**5 + &
   (-8.23742964939)*t**6 + (-9.14285714286)*t**7 
  dP( 7 ) = (0.175987730497)*t**0 + (-7.53731002679)*t**1 + (-12.5486744803)*t**2 + &
   (47.3901007859)*t**3 + (65.7488045289)*t**4 + (-49.4245778964)*t**5 + &
   (-64.0)*t**6 
  P( 8 ) = (-0.0714285714286)*t**0 + (-0.0714285714286)*t**1 + (1.71428571429)*t**2 + &
   (1.71428571429)*t**3 + (-5.71428571429)*t**4 + (-5.71428571429)*t**5 + &
   (4.57142857143)*t**6 + (4.57142857143)*t**7 
  dP( 8 ) = (-0.0714285714286)*t**0 + (3.42857142857)*t**1 + (5.14285714286)*t**2 + &
   (-22.8571428571)*t**3 + (-28.5714285714)*t**4 + (27.4285714286)*t**5 + &
   (32.0)*t**6 

 Case( 9 )
  P( 1 ) = (0.5)*t**1 + (-0.5)*t**2 + (-5.0)*t**3 + &
   (5.0)*t**4 + (12.0)*t**5 + (-12.0)*t**6 + &
   (-8.0)*t**7 + (8.0)*t**8 
  dP( 1 ) = (0.5)*t**0 + (-1.0)*t**1 + (-15.0)*t**2 + &
   (20.0)*t**3 + (60.0)*t**4 + (-72.0)*t**5 + &
   (-56.0)*t**6 + (64.0)*t**7 
  P( 2 ) = (-1.08239220029)*t**1 + (1.17157287525)*t**2 + (10.638212861)*t**3 + &
   (-11.5147186258)*t**4 + (-24.3378931809)*t**5 + (26.3431457505)*t**6 + &
   (14.7820725202)*t**7 + (-16.0)*t**8 
  dP( 2 ) = (-1.08239220029)*t**0 + (2.34314575051)*t**1 + (31.9146385829)*t**2 + &
   (-46.058874503)*t**3 + (-121.689465904)*t**4 + (158.058874503)*t**5 + &
   (103.474507641)*t**6 + (-128.0)*t**7 
  P( 3 ) = (1.41421356237)*t**1 + (-2.0)*t**2 + (-12.7279220614)*t**3 + &
   (18.0)*t**4 + (22.627416998)*t**5 + (-32.0)*t**6 + &
   (-11.313708499)*t**7 + (16.0)*t**8 
  dP( 3 ) = (1.41421356237)*t**0 + (-4.0)*t**1 + (-38.1837661841)*t**2 + &
   (72.0)*t**3 + (113.13708499)*t**4 + (-192.0)*t**5 + &
   (-79.1959594929)*t**6 + (128.0)*t**7 
  P( 4 ) = (-2.61312592975)*t**1 + (6.82842712475)*t**2 + (10.9008452482)*t**3 + &
   (-28.4852813742)*t**4 + (-14.4106542363)*t**5 + (37.6568542495)*t**6 + &
   (6.12293491784)*t**7 + (-16.0)*t**8 
  dP( 4 ) = (-2.61312592975)*t**0 + (13.6568542495)*t**1 + (32.7025357445)*t**2 + &
   (-113.941125497)*t**3 + (-72.0532711813)*t**4 + (225.941125497)*t**5 + &
   (42.8605444249)*t**6 + (-128.0)*t**7 
  P( 5 ) = (1.0)*t**0 + (2.22044604925e-16)*t**1 + (-11.0)*t**2 + &
   (5.3290705182e-15)*t**3 + (34.0)*t**4 + (-2.84217094304e-14)*t**5 + &
   (-40.0)*t**6 + (-3.5527136788e-15)*t**7 + (16.0)*t**8 
  dP( 5 ) = (-2.22044604925e-16)*t**0 + (-22.0)*t**1 + (1.24344978758e-14)*t**2 + &
   (136.0)*t**3 + (-8.17124146124e-14)*t**4 + (-240.0)*t**5 + &
   (-1.06581410364e-14)*t**6 + (128.0)*t**7 
  P( 6 ) = (2.61312592975)*t**1 + (6.82842712475)*t**2 + (-10.9008452482)*t**3 + &
   (-28.4852813742)*t**4 + (14.4106542363)*t**5 + (37.6568542495)*t**6 + &
   (-6.12293491784)*t**7 + (-16.0)*t**8 
  dP( 6 ) = (2.61312592975)*t**0 + (13.6568542495)*t**1 + (-32.7025357445)*t**2 + &
   (-113.941125497)*t**3 + (72.0532711813)*t**4 + (225.941125497)*t**5 + &
   (-42.8605444249)*t**6 + (-128.0)*t**7 
  P( 7 ) = (-1.41421356237)*t**1 + (-2.0)*t**2 + (12.7279220614)*t**3 + &
   (18.0)*t**4 + (-22.627416998)*t**5 + (-32.0)*t**6 + &
   (11.313708499)*t**7 + (16.0)*t**8 
  dP( 7 ) = (-1.41421356237)*t**0 + (-4.0)*t**1 + (38.1837661841)*t**2 + &
   (72.0)*t**3 + (-113.13708499)*t**4 + (-192.0)*t**5 + &
   (79.1959594929)*t**6 + (128.0)*t**7 
  P( 8 ) = (1.08239220029)*t**1 + (1.17157287525)*t**2 + (-10.638212861)*t**3 + &
   (-11.5147186258)*t**4 + (24.3378931809)*t**5 + (26.3431457505)*t**6 + &
   (-14.7820725202)*t**7 + (-16.0)*t**8 
  dP( 8 ) = (1.08239220029)*t**0 + (2.34314575051)*t**1 + (-31.9146385829)*t**2 + &
   (-46.058874503)*t**3 + (121.689465904)*t**4 + (158.058874503)*t**5 + &
   (-103.474507641)*t**6 + (-128.0)*t**7 
  P( 9 ) = (-0.5)*t**1 + (-0.5)*t**2 + (5.0)*t**3 + &
   (5.0)*t**4 + (-12.0)*t**5 + (-12.0)*t**6 + &
   (8.0)*t**7 + (8.0)*t**8 
  dP( 9 ) = (-0.5)*t**0 + (-1.0)*t**1 + (15.0)*t**2 + &
   (20.0)*t**3 + (-60.0)*t**4 + (-72.0)*t**5 + &
   (56.0)*t**6 + (64.0)*t**7    

  END SELECT
END SUBROUTINE
